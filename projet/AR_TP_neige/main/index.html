<html>

<head>
  <script src="https://aframe.io/releases/1.0.3/aframe.min.js"></script>
  <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
  <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.13.1/dist/aframe-extras.min.js"></script>
  <script src="perlin.js"></script>
</head>

<body>
  <a-scene embedded arjs="debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
    <a-marker type='barcode' value="2">
      <a-entity id="container"></a-entity>
      <!-- <a-sphere position="0 0 0" radius="0.5" material="roughness: 1." src="./model/texture/snow_texture.jpg"
        color="#FF0000" mass="0.5"></a-sphere> -->
    </a-marker>
    <a-marker type='barcode' value="3">
      <a-plane static-body position="0 0 0" rotation="-90 0 0" width="5" height="5"></a-plane>
    </a-marker>
    <!-- <a-sky color="#ECECEC"></a-sky> -->
    <a-entity camera></a-entity>
    <!-- <a-entity camera look-controls position="0 1.6 5"></a-entity> -->
    <a-entity geometry="primitive: example; n:10; res:5" src="./model/texture/rock.jpeg" color = "#FFFFFF"></a-entity>

  </a-scene>

  <script>
    let container = document.querySelector("#container");
    addBall();

    function addBall() {
      let x = 0
      let y = 10
      let z = 0
      container.innerHTML += `<a-sphere dynamic-body position="${x} ${y} ${z}" radius="0.1" src="./model/texture/snow_texture.jpg" mass="0.5"></a-sphere>`
    }


    AFRAME.registerGeometry('example', {
        schema: {
          n: {
            default: 20
          },
          res: {
            default: 5
          }
        },
      
        init: function (data) {
          var geometry = new THREE.Geometry();
          let MNT = main(data.n,data.res);
          let vertices = [];
          let n = MNT.length;
          let m = MNT[0].length;
          for (i=0;i<n;i++){
            for (j=0;j<m;j++){
              vertices.push(new THREE.Vector3(i, MNT[i][j],j));
            }  
          }
          geometry.vertices = vertices;
          geometry.computeBoundingBox();
          for (i=0;i<n-1;i++){
            for (j=0;j<m-1;j++){
              geometry.faces.push(new THREE.Face3(i*n+j, i*n+j+1, (i+1)*n+j));
              geometry.faces.push(new THREE.Face3(i*n+j+1, (i+1)*n+1+j, (i+1)*n+j));
              console.log(i*n+j, i*n+j+1, (i+1)*n+j);
              console.log(i*n+j+1, (i+1)*n+1+j, (i+1)*n+j);
            }  
          }
          geometry.mergeVertices();
          geometry.computeFaceNormals();
          geometry.computeVertexNormals();
          this.geometry = geometry;
        }
      });
  </script>
</body>

</html>